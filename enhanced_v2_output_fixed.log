ğŸš€ Starting MLB ENHANCED V2 Model Training Pipeline
ğŸ¯ TARGET: Mid-60s accuracy (up from 50.1%)
ğŸ”§ ENHANCEMENTS: Better hyperparams, feature engineering, model architecture

ğŸ“Š Loading datasets...
ğŸ“¥ Loading: SELECT * FROM parquet_scan(['data/features/statcast_2018.parquet', 'data/features/statcast_2019.parq...
ğŸ“¥ Loading: 
            SELECT * FROM parquet_scan("data/features/statcast_2024.parquet") 
            WHERE ga...
ğŸ“¥ Loading: 
            SELECT * FROM parquet_scan("data/features/statcast_2024.parquet") 
            WHERE ga...
ğŸ”§ Creating enhanced features...
âœ… Enhanced features created: 11 new features
ğŸ”§ Creating enhanced features...
âœ… Enhanced features created: 11 new features
ğŸ”§ Creating enhanced features...
âœ… Enhanced features created: 11 new features
âš–ï¸  Weight range: 0.1859 - 0.9531
âœ… Train: 4,079,231 rows
âœ… Val: 459,015 rows
âœ… Test: 517,760 rows

ğŸ” Class distribution analysis...
ğŸ“Š Class distribution:
   CH: 0.108 (10.8%)
   CU: 0.072 (7.2%)
   FC: 0.071 (7.1%)
   FF: 0.332 (33.2%)
   FS: 0.018 (1.8%)
   KC: 0.023 (2.3%)
   OTHER: 0.060 (6.0%)
   SI: 0.155 (15.5%)
   SL: 0.163 (16.3%)
âœ… Minimum class support: 0.018

ğŸ¯ HEAD A: Pitch Type Classification (ENHANCED)

ğŸ”§ ENHANCED prep for: pitch_type_can
ğŸš¨ REMOVED: pitch_type (potential leakage)
ğŸš¨ Removing 29 current-pitch measurement features
ğŸ—‘ï¸  Dropped 45 columns, keeping 104 features
âœ… ENHANCED: 104 features, 4,079,231 samples
ğŸ“‹ Pitch types: ['CH', 'CU', 'FC', 'FF', 'FS', 'KC', 'OTHER', 'SI', 'SL']

ğŸ”§ ENHANCED prep for: pitch_type_can
ğŸš¨ REMOVED: pitch_type (potential leakage)
ğŸš¨ Removing 29 current-pitch measurement features
ğŸ—‘ï¸  Dropped 44 columns, keeping 104 features
âœ… ENHANCED: 104 features, 459,015 samples
ğŸš‚ Training ENHANCED pitch type model...
ğŸ”§ Enhanced hyperparameters: lr=0.03, leaves=512, depth=12
Training until validation scores don't improve for 100 rounds
[200]	valid_0's multi_logloss: 1.0734
[400]	valid_0's multi_logloss: 1.07026
Early stopping, best iteration is:
[368]	valid_0's multi_logloss: 1.07019
âœ… Enhanced pitch type model trained! Iterations: 3312, Time: 2531.9s
ğŸ’¾ CHECKPOINT: Saving pitch type model...
âœ… Pitch type model checkpoint saved!

ğŸ”§ Adding enhanced pitch probability features...

ğŸ”§ ENHANCED prep for: pitch_type_can
ğŸš¨ REMOVED: pitch_type (potential leakage)
ğŸš¨ Removing 29 current-pitch measurement features
ğŸ—‘ï¸  Dropped 45 columns, keeping 104 features
âœ… ENHANCED: 104 features, 4,079,231 samples

ğŸ”§ ENHANCED prep for: pitch_type_can
ğŸš¨ REMOVED: pitch_type (potential leakage)
ğŸš¨ Removing 29 current-pitch measurement features
ğŸ—‘ï¸  Dropped 44 columns, keeping 104 features
âœ… ENHANCED: 104 features, 459,015 samples

ğŸ¯ HEAD B: xwOBA Regression (ENHANCED)

ğŸ”§ ENHANCED prep for: estimated_woba_using_speedangle
ğŸš¨ REMOVED: pitch_type (potential leakage)
ğŸš¨ Removing 30 current-pitch measurement features
ğŸ¯ Handling xwOBA sparsity...
   NULL xwOBA: 3,086,464 / 4,079,231 (75.7%)
   ğŸ”„ FILTERING to in-play events only
   âœ… Filtered to 992,767 in-play events
ğŸ—‘ï¸  Dropped 46 columns, keeping 117 features
âœ… ENHANCED: 117 features, 992,767 samples

ğŸ”§ ENHANCED prep for: estimated_woba_using_speedangle
ğŸš¨ REMOVED: pitch_type (potential leakage)
ğŸš¨ Removing 30 current-pitch measurement features
ğŸ¯ Handling xwOBA sparsity...
   NULL xwOBA: 341,779 / 459,015 (74.5%)
   ğŸ”„ FILTERING to in-play events only
   âœ… Filtered to 117,236 in-play events
ğŸ—‘ï¸  Dropped 45 columns, keeping 117 features
âœ… ENHANCED: 117 features, 117,236 samples
ğŸš‚ Training ENHANCED xwOBA model...
Training until validation scores don't improve for 100 rounds
[200]	valid_0's rmse: 0.337411
[400]	valid_0's rmse: 0.336575
Early stopping, best iteration is:
[451]	valid_0's rmse: 0.336542
âœ… Enhanced xwOBA model trained! Iterations: 451, Time: 114.3s
ğŸ’¾ CHECKPOINT: Saving xwOBA model...
âœ… xwOBA model checkpoint saved!

ğŸ“Š Enhanced Evaluation...
ğŸ”§ Creating enhanced features...
âœ… Enhanced features created: 11 new features

ğŸ”§ ENHANCED prep for: pitch_type_can
ğŸš¨ REMOVED: pitch_type (potential leakage)
ğŸš¨ Removing 29 current-pitch measurement features
ğŸ—‘ï¸  Dropped 44 columns, keeping 104 features
âœ… ENHANCED: 104 features, 459,015 samples
ğŸ”§ Creating enhanced features...
âœ… Enhanced features created: 11 new features

ğŸ”§ ENHANCED prep for: pitch_type_can
ğŸš¨ REMOVED: pitch_type (potential leakage)
ğŸš¨ Removing 29 current-pitch measurement features
ğŸ—‘ï¸  Dropped 44 columns, keeping 104 features
âœ… ENHANCED: 104 features, 459,015 samples

ğŸ”§ ENHANCED prep for: estimated_woba_using_speedangle
ğŸš¨ REMOVED: pitch_type (potential leakage)
ğŸš¨ Removing 30 current-pitch measurement features
ğŸ¯ Handling xwOBA sparsity...
   NULL xwOBA: 341,779 / 459,015 (74.5%)
   ğŸ”„ FILTERING to in-play events only
   âœ… Filtered to 117,236 in-play events
ğŸ—‘ï¸  Dropped 45 columns, keeping 117 features
âœ… ENHANCED: 117 features, 117,236 samples
ğŸ”§ Creating enhanced features...
âœ… Enhanced features created: 11 new features

ğŸ”§ ENHANCED prep for: pitch_type_can
ğŸš¨ REMOVED: pitch_type (potential leakage)
ğŸš¨ Removing 29 current-pitch measurement features
ğŸ—‘ï¸  Dropped 44 columns, keeping 104 features
âœ… ENHANCED: 104 features, 517,760 samples
ğŸ”§ Creating enhanced features...
âœ… Enhanced features created: 11 new features

ğŸ”§ ENHANCED prep for: pitch_type_can
ğŸš¨ REMOVED: pitch_type (potential leakage)
ğŸš¨ Removing 29 current-pitch measurement features
ğŸ—‘ï¸  Dropped 44 columns, keeping 104 features
âœ… ENHANCED: 104 features, 517,760 samples

ğŸ”§ ENHANCED prep for: estimated_woba_using_speedangle
ğŸš¨ REMOVED: pitch_type (potential leakage)
ğŸš¨ Removing 30 current-pitch measurement features
ğŸ¯ Handling xwOBA sparsity...
   NULL xwOBA: 397,043 / 517,760 (76.7%)
   ğŸ”„ FILTERING to in-play events only
   âœ… Filtered to 120,717 in-play events
ğŸ—‘ï¸  Dropped 45 columns, keeping 117 features
âœ… ENHANCED: 117 features, 120,717 samples

ğŸ¯ ENHANCED Results:
ğŸ“Š VALIDATION:
   Pitch-type accuracy: 0.493 (49.3%)
   Pitch-type top-3 acc: 0.934 (93.4%)
   Pitch-type log-loss: 1.070
   xwOBA RMSE: 0.3365

ğŸ“Š TEST:
   Pitch-type accuracy: 0.501 (50.1%)
   Pitch-type top-3 acc: 0.928 (92.8%)
   Pitch-type log-loss: 1.062
   xwOBA RMSE: 0.3388

ğŸ“‹ Per-Class Accuracy (Test):
   CH: 0.345 (34.5%)
   CU: 0.239 (23.9%)
   FC: 0.374 (37.4%)
   FF: 0.642 (64.2%)
   FS: 0.494 (49.4%)
   KC: 0.296 (29.6%)
   OTHER: 0.585 (58.5%)
   SI: 0.546 (54.6%)
   SL: 0.407 (40.7%)

ğŸ” Top 15 Enhanced Features:
   USAGE_30_OTHER: 5570006
   USAGE_30_SI: 5333323
   USAGE_30_FC: 4467679
   USAGE_30_SL: 4058894
   USAGE_30_FF: 3897273
   USAGE_30_CU: 2912358
   USAGE_30_CH: 2490790
   USAGE_30_KC: 2105556
   USAGE_30_FS: 1420627
   count_state: 1241387
   USAGE_TD_SL: 1220399
   USAGE_TD_SI: 1016983
   XWOBA_TD_CH: 985858
   USAGE_TD_FF: 836479
   USAGE_TD_OTHER: 815658

ğŸ“¦ Saving ENHANCED models...
âœ… ENHANCED Models saved successfully!
ğŸ“ Files saved to: models/
   - pitch_type_enhanced_v2.lgb
   - xwoba_enhanced_v2.lgb
   - model_metadata_enhanced_v2.json

ğŸ‰ ENHANCED Training complete!
ğŸ¯ Key improvements:
   - Accuracy: 50.1% (target: 60%+)
   - Improvement: +0.0 percentage points
   - Top-3 accuracy: 92.8%
   - Enhanced features and hyperparameters applied âœ…
   ğŸ“ˆ Progress made, consider additional enhancements for 60%+ target
